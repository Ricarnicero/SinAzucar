{"version":3,"sources":["../node_modules/@firebase/messaging/node_modules/tslib/tslib.es6.js","../node_modules/@firebase/messaging/dist/index.esm.js"],"names":["_assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","v","op","TypeError","pop","push","__values","o","m","__read","r","ar","error","index_esm_a","ERROR_MAP","ERROR_FACTORY","util_dist_index_cjs","getMissingValueError","valueName","create","arrayToBase64","array","uint8Array","Uint8Array","btoa","String","fromCharCode","concat","__spread","replace","OLD_DB_NAME","OLD_DB_VERSION","OLD_OBJECT_STORE_NAME","migrateOldDatabase","senderId","databases","tokenDetails","_this","_a","indexedDB","map","db","name","includes","idb","objectStore","oldDetails","_b","oldVersion","objectStoreNames","contains","transaction","index","get","clear","auth","p256dh","endpoint","token","fcmToken","createTime","Date","now","subscriptionOptions","swScope","vapidKey","close","checkTokenDetails","DATABASE_NAME","DATABASE_VERSION","OBJECT_STORE_NAME","dbPromise","getDbPromise","upgradeDb","createObjectStore","dbGet","firebaseDependencies","key","oldTokenDetails","getKey","appConfig","dbSet","tx","put","complete","dbRemove","delete","appId","DEFAULT_VAPID_KEY","ENDPOINT","FCM_MSG","CONSOLE_CAMPAIGN_ID","requestGetToken","headers","subscribeOptions","responseData","err_1","message","getHeaders","getBody","method","JSON","stringify","fetch","getEndpoint","json","errorInfo","requestUpdateToken","updateOptions","err_2","requestDeleteToken","unsubscribeOptions","err_3","projectId","installations","authToken","getToken","Headers","Content-Type","Accept","x-goog-api-key","apiKey","x-goog-firebase-installations-auth","web","applicationPubKey","MessageType","TOKEN_EXPIRATION_MS","swRegistration","pushSubscription","e_1","Notification","permission","getPushSubscription","scope","getNewToken","dbOptions","currentOptions","isVapidKeyEqual","isEndpointEqual","isAuthEqual","isP256dhEqual","isTokenValid","console","warn","updateToken","deleteToken","pushManager","getSubscription","unsubscribe","updatedToken","updatedTokenDetails","e_2","subscription","subscribe","userVisibleOnly","applicationServerKey","isConsoleMessage","data","index_esm_WindowController","WindowController","onMessageCallback","navigator","serviceWorker","addEventListener","messageEventListener","defineProperty","app","enumerable","configurable","getServiceWorkerRegistration","requestPermission","permissionResult","usePublicVapidKey","useServiceWorker","ServiceWorkerRegistration","onMessage","nextOrObserver","setBackgroundMessageHandler","onTokenRefresh","register","update","catch","browserErrorMessage","event","type","payload","_c","firebaseMessaging","PUSH_RECEIVED","logEvent","messageType","eventType","NOTIFICATION_CLICKED","Error","getEventType","analyticsProvider","message_id","message_name","message_time","message_device_time","Math","floor","index_esm_SwController","SwController","bgMessageHandler","self","waitUntil","onPush","onSubChange","onNotificationClick","callback","_d","registration","clientList","notificationDetails","err","getMessagePayload","getClientList","some","client","visibilityState","url","startsWith","hasVisibleClients","sendMessageToWindowClients","notification","notificationInformation","getNotificationData","showNotification","newSubscription","link","action","stopImmediatePropagation","fcmOptions","click_action","location","origin","getLink","getWindowClient","clients","openWindow","ms","setTimeout","focus","createNewMessage","postMessage","parsedURL","clientList_1","clientList_1_1","URL","href","e_1_1","clientList_2","clientList_2_1","e_2_1","matchAll","includeUncontrolled","details","title","actions","maxActions","NAMESPACE_EXPORTS","isSupported","PushSubscription","window","cookieEnabled","index_cjs_default","a","INTERNAL","registerComponent","dist_index_cjs","container","getProvider","getImmediate","options","configKeys_1","configKeys_1_1","keyName","appName","messagingSenderId","extractAppConfig","setServiceProps"],"mappings":"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","file":"static/js/8.73ce8953.chunk.js","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\n\n/* global Reflect, Promise */\nvar _extendStatics = function extendStatics(d, b) {\n  _extendStatics = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (d, b) {\n    d.__proto__ = b;\n  } || function (d, b) {\n    for (var p in b) {\n      if (b.hasOwnProperty(p)) d[p] = b[p];\n    }\n  };\n\n  return _extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  _extendStatics(d, b);\n\n  function __() {\n    this.constructor = d;\n  }\n\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nvar _assign = function __assign() {\n  _assign = Object.assign || function __assign(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return _assign.apply(this, arguments);\n};\n\nexport { _assign as __assign };\nexport function __rest(s, e) {\n  var t = {};\n\n  for (var p in s) {\n    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  }\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n}\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\nexport function __param(paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n}\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : new P(function (resolve) {\n        resolve(result.value);\n      }).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\nexport function __generator(thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function sent() {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) {\n      try {\n        if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n        if (y = 0, t) op = [op[0] & 2, t.value];\n\n        switch (op[0]) {\n          case 0:\n          case 1:\n            t = op;\n            break;\n\n          case 4:\n            _.label++;\n            return {\n              value: op[1],\n              done: false\n            };\n\n          case 5:\n            _.label++;\n            y = op[1];\n            op = [0];\n            continue;\n\n          case 7:\n            op = _.ops.pop();\n\n            _.trys.pop();\n\n            continue;\n\n          default:\n            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n              _ = 0;\n              continue;\n            }\n\n            if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n              _.label = op[1];\n              break;\n            }\n\n            if (op[0] === 6 && _.label < t[1]) {\n              _.label = t[1];\n              t = op;\n              break;\n            }\n\n            if (t && _.label < t[2]) {\n              _.label = t[2];\n\n              _.ops.push(op);\n\n              break;\n            }\n\n            if (t[2]) _.ops.pop();\n\n            _.trys.pop();\n\n            continue;\n        }\n\n        op = body.call(thisArg, _);\n      } catch (e) {\n        op = [6, e];\n        y = 0;\n      } finally {\n        f = t = 0;\n      }\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n}\nexport function __exportStar(m, exports) {\n  for (var p in m) {\n    if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n  }\n}\nexport function __values(o) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator],\n      i = 0;\n  if (m) return m.call(o);\n  return {\n    next: function next() {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n}\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n}\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++) {\n    ar = ar.concat(__read(arguments[i]));\n  }\n\n  return ar;\n}\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) {\n    s += arguments[i].length;\n  }\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) {\n    for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) {\n      r[k] = a[j];\n    }\n  }\n\n  return r;\n}\n;\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []),\n      i,\n      q = [];\n  return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () {\n    return this;\n  }, i;\n\n  function verb(n) {\n    if (g[n]) i[n] = function (v) {\n      return new Promise(function (a, b) {\n        q.push([n, v, a, b]) > 1 || resume(n, v);\n      });\n    };\n  }\n\n  function resume(n, v) {\n    try {\n      step(g[n](v));\n    } catch (e) {\n      settle(q[0][3], e);\n    }\n  }\n\n  function step(r) {\n    r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r);\n  }\n\n  function fulfill(value) {\n    resume(\"next\", value);\n  }\n\n  function reject(value) {\n    resume(\"throw\", value);\n  }\n\n  function settle(f, v) {\n    if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]);\n  }\n}\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) {\n    throw e;\n  }), verb(\"return\"), i[Symbol.iterator] = function () {\n    return this;\n  }, i;\n\n  function verb(n, f) {\n    i[n] = o[n] ? function (v) {\n      return (p = !p) ? {\n        value: __await(o[n](v)),\n        done: n === \"return\"\n      } : f ? f(v) : v;\n    } : f;\n  }\n}\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator],\n      i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () {\n    return this;\n  }, i);\n\n  function verb(n) {\n    i[n] = o[n] && function (v) {\n      return new Promise(function (resolve, reject) {\n        v = o[n](v), settle(resolve, reject, v.done, v.value);\n      });\n    };\n  }\n\n  function settle(resolve, reject, d, v) {\n    Promise.resolve(v).then(function (v) {\n      resolve({\n        value: v,\n        done: d\n      });\n    }, reject);\n  }\n}\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) {\n    Object.defineProperty(cooked, \"raw\", {\n      value: raw\n    });\n  } else {\n    cooked.raw = raw;\n  }\n\n  return cooked;\n}\n;\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n  }\n  result.default = mod;\n  return result;\n}\nexport function __importDefault(mod) {\n  return mod && mod.__esModule ? mod : {\n    default: mod\n  };\n}","import firebase from '@firebase/app';\nimport '@firebase/installations';\nimport { Component } from '@firebase/component';\nimport { __values, __spread, __awaiter, __generator, __assign } from 'tslib';\nimport { ErrorFactory } from '@firebase/util';\nimport { deleteDb, openDb } from 'idb';\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar _a;\n\nvar ERROR_MAP = (_a = {}, _a[\"missing-app-config-values\"\n/* MISSING_APP_CONFIG_VALUES */\n] = 'Missing App configuration value: \"{$valueName}\"', _a[\"only-available-in-window\"\n/* AVAILABLE_IN_WINDOW */\n] = 'This method is available in a Window context.', _a[\"only-available-in-sw\"\n/* AVAILABLE_IN_SW */\n] = 'This method is available in a service worker context.', _a[\"permission-default\"\n/* PERMISSION_DEFAULT */\n] = 'The notification permission was not granted and dismissed instead.', _a[\"permission-blocked\"\n/* PERMISSION_BLOCKED */\n] = 'The notification permission was not granted and blocked instead.', _a[\"unsupported-browser\"\n/* UNSUPPORTED_BROWSER */\n] = \"This browser doesn't support the API's required to use the firebase SDK.\", _a[\"failed-service-worker-registration\"\n/* FAILED_DEFAULT_REGISTRATION */\n] = 'We are unable to register the default service worker. {$browserErrorMessage}', _a[\"token-subscribe-failed\"\n/* TOKEN_SUBSCRIBE_FAILED */\n] = 'A problem occured while subscribing the user to FCM: {$errorInfo}', _a[\"token-subscribe-no-token\"\n/* TOKEN_SUBSCRIBE_NO_TOKEN */\n] = 'FCM returned no token when subscribing the user to push.', _a[\"token-unsubscribe-failed\"\n/* TOKEN_UNSUBSCRIBE_FAILED */\n] = 'A problem occured while unsubscribing the ' + 'user from FCM: {$errorInfo}', _a[\"token-update-failed\"\n/* TOKEN_UPDATE_FAILED */\n] = 'A problem occured while updating the user from FCM: {$errorInfo}', _a[\"token-update-no-token\"\n/* TOKEN_UPDATE_NO_TOKEN */\n] = 'FCM returned no token when updating the user to push.', _a[\"use-sw-after-get-token\"\n/* USE_SW_AFTER_GET_TOKEN */\n] = 'The useServiceWorker() method may only be called once and must be ' + 'called before calling getToken() to ensure your service worker is used.', _a[\"invalid-sw-registration\"\n/* INVALID_SW_REGISTRATION */\n] = 'The input to useServiceWorker() must be a ServiceWorkerRegistration.', _a[\"invalid-bg-handler\"\n/* INVALID_BG_HANDLER */\n] = 'The input to setBackgroundMessageHandler() must be a function.', _a[\"invalid-vapid-key\"\n/* INVALID_VAPID_KEY */\n] = 'The public VAPID key must be a string.', _a[\"use-vapid-key-after-get-token\"\n/* USE_VAPID_KEY_AFTER_GET_TOKEN */\n] = 'The usePublicVapidKey() method may only be called once and must be ' + 'called before calling getToken() to ensure your VAPID key is used.', _a);\nvar ERROR_FACTORY = new ErrorFactory('messaging', 'Messaging', ERROR_MAP);\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nfunction extractAppConfig(app) {\n  var e_1, _a;\n\n  if (!app || !app.options) {\n    throw getMissingValueError('App Configuration Object');\n  }\n\n  if (!app.name) {\n    throw getMissingValueError('App Name');\n  } // Required app config keys\n\n\n  var configKeys = ['projectId', 'apiKey', 'appId', 'messagingSenderId'];\n  var options = app.options;\n\n  try {\n    for (var configKeys_1 = __values(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\n      var keyName = configKeys_1_1.value;\n\n      if (!options[keyName]) {\n        throw getMissingValueError(keyName);\n      }\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1.return)) _a.call(configKeys_1);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n\n  return {\n    appName: app.name,\n    projectId: options.projectId,\n    apiKey: options.apiKey,\n    appId: options.appId,\n    senderId: options.messagingSenderId\n  };\n}\n\nfunction getMissingValueError(valueName) {\n  return ERROR_FACTORY.create(\"missing-app-config-values\"\n  /* MISSING_APP_CONFIG_VALUES */\n  , {\n    valueName: valueName\n  });\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction arrayToBase64(array) {\n  var uint8Array = new Uint8Array(array);\n  var base64String = btoa(String.fromCharCode.apply(String, __spread(uint8Array)));\n  return base64String.replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar OLD_DB_NAME = 'fcm_token_details_db';\n/**\r\n * The last DB version of 'fcm_token_details_db' was 4. This is one higher,\r\n * so that the upgrade callback is called for all versions of the old DB.\r\n */\n\nvar OLD_DB_VERSION = 5;\nvar OLD_OBJECT_STORE_NAME = 'fcm_token_object_Store';\n\nfunction migrateOldDatabase(senderId) {\n  return __awaiter(this, void 0, void 0, function () {\n    var databases, dbNames, tokenDetails, db;\n\n    var _this = this;\n\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          if (!('databases' in indexedDB)) return [3\n          /*break*/\n          , 2];\n          return [4\n          /*yield*/\n          , indexedDB.databases()];\n\n        case 1:\n          databases = _a.sent();\n          dbNames = databases.map(function (db) {\n            return db.name;\n          });\n\n          if (!dbNames.includes(OLD_DB_NAME)) {\n            // old DB didn't exist, no need to open.\n            return [2\n            /*return*/\n            , null];\n          }\n\n          _a.label = 2;\n\n        case 2:\n          tokenDetails = null;\n          return [4\n          /*yield*/\n          , openDb(OLD_DB_NAME, OLD_DB_VERSION, function (db) {\n            return __awaiter(_this, void 0, void 0, function () {\n              var objectStore, value, oldDetails, oldDetails, oldDetails;\n\n              var _a;\n\n              return __generator(this, function (_b) {\n                switch (_b.label) {\n                  case 0:\n                    if (db.oldVersion < 2) {\n                      // Database too old, skip migration.\n                      return [2\n                      /*return*/\n                      ];\n                    }\n\n                    if (!db.objectStoreNames.contains(OLD_OBJECT_STORE_NAME)) {\n                      // Database did not exist. Nothing to do.\n                      return [2\n                      /*return*/\n                      ];\n                    }\n\n                    objectStore = db.transaction.objectStore(OLD_OBJECT_STORE_NAME);\n                    return [4\n                    /*yield*/\n                    , objectStore.index('fcmSenderId').get(senderId)];\n\n                  case 1:\n                    value = _b.sent();\n                    return [4\n                    /*yield*/\n                    , objectStore.clear()];\n\n                  case 2:\n                    _b.sent();\n\n                    if (!value) {\n                      // No entry in the database, nothing to migrate.\n                      return [2\n                      /*return*/\n                      ];\n                    }\n\n                    if (db.oldVersion === 2) {\n                      oldDetails = value;\n\n                      if (!oldDetails.auth || !oldDetails.p256dh || !oldDetails.endpoint) {\n                        return [2\n                        /*return*/\n                        ];\n                      }\n\n                      tokenDetails = {\n                        token: oldDetails.fcmToken,\n                        createTime: (_a = oldDetails.createTime, _a !== null && _a !== void 0 ? _a : Date.now()),\n                        subscriptionOptions: {\n                          auth: oldDetails.auth,\n                          p256dh: oldDetails.p256dh,\n                          endpoint: oldDetails.endpoint,\n                          swScope: oldDetails.swScope,\n                          vapidKey: typeof oldDetails.vapidKey === 'string' ? oldDetails.vapidKey : arrayToBase64(oldDetails.vapidKey)\n                        }\n                      };\n                    } else if (db.oldVersion === 3) {\n                      oldDetails = value;\n                      tokenDetails = {\n                        token: oldDetails.fcmToken,\n                        createTime: oldDetails.createTime,\n                        subscriptionOptions: {\n                          auth: arrayToBase64(oldDetails.auth),\n                          p256dh: arrayToBase64(oldDetails.p256dh),\n                          endpoint: oldDetails.endpoint,\n                          swScope: oldDetails.swScope,\n                          vapidKey: arrayToBase64(oldDetails.vapidKey)\n                        }\n                      };\n                    } else if (db.oldVersion === 4) {\n                      oldDetails = value;\n                      tokenDetails = {\n                        token: oldDetails.fcmToken,\n                        createTime: oldDetails.createTime,\n                        subscriptionOptions: {\n                          auth: arrayToBase64(oldDetails.auth),\n                          p256dh: arrayToBase64(oldDetails.p256dh),\n                          endpoint: oldDetails.endpoint,\n                          swScope: oldDetails.swScope,\n                          vapidKey: arrayToBase64(oldDetails.vapidKey)\n                        }\n                      };\n                    }\n\n                    return [2\n                    /*return*/\n                    ];\n                }\n              });\n            });\n          })];\n\n        case 3:\n          db = _a.sent();\n          db.close(); // Delete all old databases.\n\n          return [4\n          /*yield*/\n          , deleteDb(OLD_DB_NAME)];\n\n        case 4:\n          // Delete all old databases.\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , deleteDb('fcm_vapid_details_db')];\n\n        case 5:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , deleteDb('undefined')];\n\n        case 6:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , checkTokenDetails(tokenDetails) ? tokenDetails : null];\n      }\n    });\n  });\n}\n\nfunction checkTokenDetails(tokenDetails) {\n  if (!tokenDetails || !tokenDetails.subscriptionOptions) {\n    return false;\n  }\n\n  var subscriptionOptions = tokenDetails.subscriptionOptions;\n  return typeof tokenDetails.createTime === 'number' && tokenDetails.createTime > 0 && typeof tokenDetails.token === 'string' && tokenDetails.token.length > 0 && typeof subscriptionOptions.auth === 'string' && subscriptionOptions.auth.length > 0 && typeof subscriptionOptions.p256dh === 'string' && subscriptionOptions.p256dh.length > 0 && typeof subscriptionOptions.endpoint === 'string' && subscriptionOptions.endpoint.length > 0 && typeof subscriptionOptions.swScope === 'string' && subscriptionOptions.swScope.length > 0 && typeof subscriptionOptions.vapidKey === 'string' && subscriptionOptions.vapidKey.length > 0;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n// Exported for tests.\n\n\nvar DATABASE_NAME = 'firebase-messaging-database';\nvar DATABASE_VERSION = 1;\nvar OBJECT_STORE_NAME = 'firebase-messaging-store';\nvar dbPromise = null;\n\nfunction getDbPromise() {\n  if (!dbPromise) {\n    dbPromise = openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDb) {\n      // We don't use 'break' in this switch statement, the fall-through\n      // behavior is what we want, because if there are multiple versions between\n      // the old version and the current version, we want ALL the migrations\n      // that correspond to those versions to run, not only the last one.\n      // eslint-disable-next-line default-case\n      switch (upgradeDb.oldVersion) {\n        case 0:\n          upgradeDb.createObjectStore(OBJECT_STORE_NAME);\n      }\n    });\n  }\n\n  return dbPromise;\n}\n/** Gets record(s) from the objectStore that match the given key. */\n\n\nfunction dbGet(firebaseDependencies) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tokenDetails, oldTokenDetails;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(firebaseDependencies);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          return [4\n          /*yield*/\n          , db.transaction(OBJECT_STORE_NAME).objectStore(OBJECT_STORE_NAME).get(key)];\n\n        case 2:\n          tokenDetails = _a.sent();\n          if (!tokenDetails) return [3\n          /*break*/\n          , 3];\n          return [2\n          /*return*/\n          , tokenDetails];\n\n        case 3:\n          return [4\n          /*yield*/\n          , migrateOldDatabase(firebaseDependencies.appConfig.senderId)];\n\n        case 4:\n          oldTokenDetails = _a.sent();\n          if (!oldTokenDetails) return [3\n          /*break*/\n          , 6];\n          return [4\n          /*yield*/\n          , dbSet(firebaseDependencies, oldTokenDetails)];\n\n        case 5:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , oldTokenDetails];\n\n        case 6:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/** Assigns or overwrites the record for the given key with the given value. */\n\n\nfunction dbSet(firebaseDependencies, tokenDetails) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(firebaseDependencies);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          return [4\n          /*yield*/\n          , tx.objectStore(OBJECT_STORE_NAME).put(tokenDetails, key)];\n\n        case 2:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , tx.complete];\n\n        case 3:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , tokenDetails];\n      }\n    });\n  });\n}\n/** Removes record(s) from the objectStore that match the given key. */\n\n\nfunction dbRemove(firebaseDependencies) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(firebaseDependencies);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          return [4\n          /*yield*/\n          , tx.objectStore(OBJECT_STORE_NAME).delete(key)];\n\n        case 2:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , tx.complete];\n\n        case 3:\n          _a.sent();\n\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n\nfunction getKey(_a) {\n  var appConfig = _a.appConfig;\n  return appConfig.appId;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar DEFAULT_SW_PATH = '/firebase-messaging-sw.js';\nvar DEFAULT_SW_SCOPE = '/firebase-cloud-messaging-push-scope';\nvar DEFAULT_VAPID_KEY = 'BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4';\nvar ENDPOINT = 'https://fcmregistrations.googleapis.com/v1';\n/** Key of FCM Payload in Notification's data field. */\n\nvar FCM_MSG = 'FCM_MSG';\nvar CONSOLE_CAMPAIGN_ID = 'google.c.a.c_id';\nvar CONSOLE_CAMPAIGN_NAME = 'google.c.a.c_l';\nvar CONSOLE_CAMPAIGN_TIME = 'google.c.a.ts';\n/** Set to '1' if Analytics is enabled for the campaign */\n\nvar CONSOLE_CAMPAIGN_ANALYTICS_ENABLED = 'google.c.a.e';\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nfunction requestGetToken(firebaseDependencies, subscriptionOptions) {\n  return __awaiter(this, void 0, void 0, function () {\n    var headers, body, subscribeOptions, responseData, response, err_1, message;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , getHeaders(firebaseDependencies)];\n\n        case 1:\n          headers = _a.sent();\n          body = getBody(subscriptionOptions);\n          subscribeOptions = {\n            method: 'POST',\n            headers: headers,\n            body: JSON.stringify(body)\n          };\n          _a.label = 2;\n\n        case 2:\n          _a.trys.push([2, 5,, 6]);\n\n          return [4\n          /*yield*/\n          , fetch(getEndpoint(firebaseDependencies.appConfig), subscribeOptions)];\n\n        case 3:\n          response = _a.sent();\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 4:\n          responseData = _a.sent();\n          return [3\n          /*break*/\n          , 6];\n\n        case 5:\n          err_1 = _a.sent();\n          throw ERROR_FACTORY.create(\"token-subscribe-failed\"\n          /* TOKEN_SUBSCRIBE_FAILED */\n          , {\n            errorInfo: err_1\n          });\n\n        case 6:\n          if (responseData.error) {\n            message = responseData.error.message;\n            throw ERROR_FACTORY.create(\"token-subscribe-failed\"\n            /* TOKEN_SUBSCRIBE_FAILED */\n            , {\n              errorInfo: message\n            });\n          }\n\n          if (!responseData.token) {\n            throw ERROR_FACTORY.create(\"token-subscribe-no-token\"\n            /* TOKEN_SUBSCRIBE_NO_TOKEN */\n            );\n          }\n\n          return [2\n          /*return*/\n          , responseData.token];\n      }\n    });\n  });\n}\n\nfunction requestUpdateToken(firebaseDependencies, tokenDetails) {\n  return __awaiter(this, void 0, void 0, function () {\n    var headers, body, updateOptions, responseData, response, err_2, message;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , getHeaders(firebaseDependencies)];\n\n        case 1:\n          headers = _a.sent();\n          body = getBody(tokenDetails.subscriptionOptions);\n          updateOptions = {\n            method: 'PATCH',\n            headers: headers,\n            body: JSON.stringify(body)\n          };\n          _a.label = 2;\n\n        case 2:\n          _a.trys.push([2, 5,, 6]);\n\n          return [4\n          /*yield*/\n          , fetch(getEndpoint(firebaseDependencies.appConfig) + \"/\" + tokenDetails.token, updateOptions)];\n\n        case 3:\n          response = _a.sent();\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 4:\n          responseData = _a.sent();\n          return [3\n          /*break*/\n          , 6];\n\n        case 5:\n          err_2 = _a.sent();\n          throw ERROR_FACTORY.create(\"token-update-failed\"\n          /* TOKEN_UPDATE_FAILED */\n          , {\n            errorInfo: err_2\n          });\n\n        case 6:\n          if (responseData.error) {\n            message = responseData.error.message;\n            throw ERROR_FACTORY.create(\"token-update-failed\"\n            /* TOKEN_UPDATE_FAILED */\n            , {\n              errorInfo: message\n            });\n          }\n\n          if (!responseData.token) {\n            throw ERROR_FACTORY.create(\"token-update-no-token\"\n            /* TOKEN_UPDATE_NO_TOKEN */\n            );\n          }\n\n          return [2\n          /*return*/\n          , responseData.token];\n      }\n    });\n  });\n}\n\nfunction requestDeleteToken(firebaseDependencies, token) {\n  return __awaiter(this, void 0, void 0, function () {\n    var headers, unsubscribeOptions, response, responseData, message, err_3;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , getHeaders(firebaseDependencies)];\n\n        case 1:\n          headers = _a.sent();\n          unsubscribeOptions = {\n            method: 'DELETE',\n            headers: headers\n          };\n          _a.label = 2;\n\n        case 2:\n          _a.trys.push([2, 5,, 6]);\n\n          return [4\n          /*yield*/\n          , fetch(getEndpoint(firebaseDependencies.appConfig) + \"/\" + token, unsubscribeOptions)];\n\n        case 3:\n          response = _a.sent();\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 4:\n          responseData = _a.sent();\n\n          if (responseData.error) {\n            message = responseData.error.message;\n            throw ERROR_FACTORY.create(\"token-unsubscribe-failed\"\n            /* TOKEN_UNSUBSCRIBE_FAILED */\n            , {\n              errorInfo: message\n            });\n          }\n\n          return [3\n          /*break*/\n          , 6];\n\n        case 5:\n          err_3 = _a.sent();\n          throw ERROR_FACTORY.create(\"token-unsubscribe-failed\"\n          /* TOKEN_UNSUBSCRIBE_FAILED */\n          , {\n            errorInfo: err_3\n          });\n\n        case 6:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n\nfunction getEndpoint(_a) {\n  var projectId = _a.projectId;\n  return ENDPOINT + \"/projects/\" + projectId + \"/registrations\";\n}\n\nfunction getHeaders(_a) {\n  var appConfig = _a.appConfig,\n      installations = _a.installations;\n  return __awaiter(this, void 0, void 0, function () {\n    var authToken;\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , installations.getToken()];\n\n        case 1:\n          authToken = _b.sent();\n          return [2\n          /*return*/\n          , new Headers({\n            'Content-Type': 'application/json',\n            Accept: 'application/json',\n            'x-goog-api-key': appConfig.apiKey,\n            'x-goog-firebase-installations-auth': \"FIS \" + authToken\n          })];\n      }\n    });\n  });\n}\n\nfunction getBody(_a) {\n  var p256dh = _a.p256dh,\n      auth = _a.auth,\n      endpoint = _a.endpoint,\n      vapidKey = _a.vapidKey;\n  var body = {\n    web: {\n      endpoint: endpoint,\n      auth: auth,\n      p256dh: p256dh\n    }\n  };\n\n  if (vapidKey !== DEFAULT_VAPID_KEY) {\n    body.web.applicationPubKey = vapidKey;\n  }\n\n  return body;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/** UpdateRegistration will be called once every week. */\n\n\nvar TOKEN_EXPIRATION_MS = 7 * 24 * 60 * 60 * 1000; // 7 days\n\nfunction getToken(firebaseDependencies, swRegistration, vapidKey) {\n  return __awaiter(this, void 0, void 0, function () {\n    var pushSubscription, tokenDetails, subscriptionOptions, e_1;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          if (Notification.permission !== 'granted') {\n            throw ERROR_FACTORY.create(\"permission-blocked\"\n            /* PERMISSION_BLOCKED */\n            );\n          }\n\n          return [4\n          /*yield*/\n          , getPushSubscription(swRegistration, vapidKey)];\n\n        case 1:\n          pushSubscription = _a.sent();\n          return [4\n          /*yield*/\n          , dbGet(firebaseDependencies)];\n\n        case 2:\n          tokenDetails = _a.sent();\n          subscriptionOptions = {\n            vapidKey: vapidKey,\n            swScope: swRegistration.scope,\n            endpoint: pushSubscription.endpoint,\n            auth: arrayToBase64(pushSubscription.getKey('auth')),\n            p256dh: arrayToBase64(pushSubscription.getKey('p256dh'))\n          };\n          if (!!tokenDetails) return [3\n          /*break*/\n          , 3]; // No token, get a new one.\n\n          return [2\n          /*return*/\n          , getNewToken(firebaseDependencies, subscriptionOptions)];\n\n        case 3:\n          if (!!isTokenValid(tokenDetails.subscriptionOptions, subscriptionOptions)) return [3\n          /*break*/\n          , 8];\n          _a.label = 4;\n\n        case 4:\n          _a.trys.push([4, 6,, 7]);\n\n          return [4\n          /*yield*/\n          , requestDeleteToken(firebaseDependencies, tokenDetails.token)];\n\n        case 5:\n          _a.sent();\n\n          return [3\n          /*break*/\n          , 7];\n\n        case 6:\n          e_1 = _a.sent(); // Suppress errors because of #2364\n\n          console.warn(e_1);\n          return [3\n          /*break*/\n          , 7];\n\n        case 7:\n          return [2\n          /*return*/\n          , getNewToken(firebaseDependencies, subscriptionOptions)];\n\n        case 8:\n          if (Date.now() >= tokenDetails.createTime + TOKEN_EXPIRATION_MS) {\n            // Weekly token refresh\n            return [2\n            /*return*/\n            , updateToken({\n              token: tokenDetails.token,\n              createTime: Date.now(),\n              subscriptionOptions: subscriptionOptions\n            }, firebaseDependencies, swRegistration)];\n          } else {\n            // Valid token, nothing to do.\n            return [2\n            /*return*/\n            , tokenDetails.token];\n          }\n\n        case 9:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/**\r\n * This method deletes the token from the database, unsubscribes the token from\r\n * FCM, and unregisters the push subscription if it exists.\r\n */\n\n\nfunction deleteToken(firebaseDependencies, swRegistration) {\n  return __awaiter(this, void 0, void 0, function () {\n    var tokenDetails, pushSubscription;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , dbGet(firebaseDependencies)];\n\n        case 1:\n          tokenDetails = _a.sent();\n          if (!tokenDetails) return [3\n          /*break*/\n          , 4];\n          return [4\n          /*yield*/\n          , requestDeleteToken(firebaseDependencies, tokenDetails.token)];\n\n        case 2:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , dbRemove(firebaseDependencies)];\n\n        case 3:\n          _a.sent();\n\n          _a.label = 4;\n\n        case 4:\n          return [4\n          /*yield*/\n          , swRegistration.pushManager.getSubscription()];\n\n        case 5:\n          pushSubscription = _a.sent();\n\n          if (pushSubscription) {\n            return [2\n            /*return*/\n            , pushSubscription.unsubscribe()];\n          } // If there's no SW, consider it a success.\n\n\n          return [2\n          /*return*/\n          , true];\n      }\n    });\n  });\n}\n\nfunction updateToken(tokenDetails, firebaseDependencies, swRegistration) {\n  return __awaiter(this, void 0, void 0, function () {\n    var updatedToken, updatedTokenDetails, e_2;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          _a.trys.push([0, 3,, 5]);\n\n          return [4\n          /*yield*/\n          , requestUpdateToken(firebaseDependencies, tokenDetails)];\n\n        case 1:\n          updatedToken = _a.sent();\n          updatedTokenDetails = __assign({\n            token: updatedToken,\n            createTime: Date.now()\n          }, tokenDetails);\n          return [4\n          /*yield*/\n          , dbSet(firebaseDependencies, updatedTokenDetails)];\n\n        case 2:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , updatedToken];\n\n        case 3:\n          e_2 = _a.sent();\n          return [4\n          /*yield*/\n          , deleteToken(firebaseDependencies, swRegistration)];\n\n        case 4:\n          _a.sent();\n\n          throw e_2;\n\n        case 5:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n\nfunction getNewToken(firebaseDependencies, subscriptionOptions) {\n  return __awaiter(this, void 0, void 0, function () {\n    var token, tokenDetails;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , requestGetToken(firebaseDependencies, subscriptionOptions)];\n\n        case 1:\n          token = _a.sent();\n          tokenDetails = {\n            token: token,\n            createTime: Date.now(),\n            subscriptionOptions: subscriptionOptions\n          };\n          return [4\n          /*yield*/\n          , dbSet(firebaseDependencies, tokenDetails)];\n\n        case 2:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , tokenDetails.token];\n      }\n    });\n  });\n}\n/**\r\n * Gets a PushSubscription for the current user.\r\n */\n\n\nfunction getPushSubscription(swRegistration, vapidKey) {\n  return __awaiter(this, void 0, void 0, function () {\n    var subscription;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , swRegistration.pushManager.getSubscription()];\n\n        case 1:\n          subscription = _a.sent();\n\n          if (subscription) {\n            return [2\n            /*return*/\n            , subscription];\n          }\n\n          return [2\n          /*return*/\n          , swRegistration.pushManager.subscribe({\n            userVisibleOnly: true,\n            applicationServerKey: vapidKey\n          })];\n      }\n    });\n  });\n}\n/**\r\n * Checks if the saved tokenDetails object matches the configuration provided.\r\n */\n\n\nfunction isTokenValid(dbOptions, currentOptions) {\n  var isVapidKeyEqual = currentOptions.vapidKey === dbOptions.vapidKey;\n  var isEndpointEqual = currentOptions.endpoint === dbOptions.endpoint;\n  var isAuthEqual = currentOptions.auth === dbOptions.auth;\n  var isP256dhEqual = currentOptions.p256dh === dbOptions.p256dh;\n  return isVapidKeyEqual && isEndpointEqual && isAuthEqual && isP256dhEqual;\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar MessageType;\n\n(function (MessageType) {\n  MessageType[\"PUSH_RECEIVED\"] = \"push-received\";\n  MessageType[\"NOTIFICATION_CLICKED\"] = \"notification-clicked\";\n})(MessageType || (MessageType = {}));\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction isConsoleMessage(data) {\n  // This message has a campaign ID, meaning it was sent using the\n  // Firebase Console.\n  return typeof data === 'object' && !!data && CONSOLE_CAMPAIGN_ID in data;\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar WindowController =\n/** @class */\nfunction () {\n  function WindowController(firebaseDependencies) {\n    var _this = this;\n\n    this.firebaseDependencies = firebaseDependencies;\n    this.vapidKey = null;\n    this.onMessageCallback = null;\n    navigator.serviceWorker.addEventListener('message', function (e) {\n      return _this.messageEventListener(e);\n    });\n  }\n\n  Object.defineProperty(WindowController.prototype, \"app\", {\n    get: function get() {\n      return this.firebaseDependencies.app;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  WindowController.prototype.getToken = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var swRegistration;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!this.vapidKey) {\n              this.vapidKey = DEFAULT_VAPID_KEY;\n            }\n\n            return [4\n            /*yield*/\n            , this.getServiceWorkerRegistration()];\n\n          case 1:\n            swRegistration = _a.sent();\n            if (!(Notification.permission === 'default')) return [3\n            /*break*/\n            , 3]; // The user hasn't allowed or denied notifications yet. Ask them.\n\n            return [4\n            /*yield*/\n            , Notification.requestPermission()];\n\n          case 2:\n            // The user hasn't allowed or denied notifications yet. Ask them.\n            _a.sent();\n\n            _a.label = 3;\n\n          case 3:\n            if (Notification.permission !== 'granted') {\n              throw ERROR_FACTORY.create(\"permission-blocked\"\n              /* PERMISSION_BLOCKED */\n              );\n            }\n\n            return [2\n            /*return*/\n            , getToken(this.firebaseDependencies, swRegistration, this.vapidKey)];\n        }\n      });\n    });\n  };\n\n  WindowController.prototype.deleteToken = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var swRegistration;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.getServiceWorkerRegistration()];\n\n          case 1:\n            swRegistration = _a.sent();\n            return [2\n            /*return*/\n            , deleteToken(this.firebaseDependencies, swRegistration)];\n        }\n      });\n    });\n  };\n  /**\r\n   * Request permission if it is not currently granted.\r\n   *\r\n   * @return Resolves if the permission was granted, rejects otherwise.\r\n   *\r\n   * @deprecated Use Notification.requestPermission() instead.\r\n   * https://developer.mozilla.org/en-US/docs/Web/API/Notification/requestPermission\r\n   */\n\n\n  WindowController.prototype.requestPermission = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var permissionResult;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (Notification.permission === 'granted') {\n              return [2\n              /*return*/\n              ];\n            }\n\n            return [4\n            /*yield*/\n            , Notification.requestPermission()];\n\n          case 1:\n            permissionResult = _a.sent();\n\n            if (permissionResult === 'granted') {\n              return [2\n              /*return*/\n              ];\n            } else if (permissionResult === 'denied') {\n              throw ERROR_FACTORY.create(\"permission-blocked\"\n              /* PERMISSION_BLOCKED */\n              );\n            } else {\n              throw ERROR_FACTORY.create(\"permission-default\"\n              /* PERMISSION_DEFAULT */\n              );\n            }\n\n        }\n      });\n    });\n  }; // TODO: Deprecate this and make VAPID key a parameter in getToken.\n\n\n  WindowController.prototype.usePublicVapidKey = function (vapidKey) {\n    if (this.vapidKey !== null) {\n      throw ERROR_FACTORY.create(\"use-vapid-key-after-get-token\"\n      /* USE_VAPID_KEY_AFTER_GET_TOKEN */\n      );\n    }\n\n    if (typeof vapidKey !== 'string' || vapidKey.length === 0) {\n      throw ERROR_FACTORY.create(\"invalid-vapid-key\"\n      /* INVALID_VAPID_KEY */\n      );\n    }\n\n    this.vapidKey = vapidKey;\n  };\n\n  WindowController.prototype.useServiceWorker = function (swRegistration) {\n    if (!(swRegistration instanceof ServiceWorkerRegistration)) {\n      throw ERROR_FACTORY.create(\"invalid-sw-registration\"\n      /* INVALID_SW_REGISTRATION */\n      );\n    }\n\n    if (this.swRegistration) {\n      throw ERROR_FACTORY.create(\"use-sw-after-get-token\"\n      /* USE_SW_AFTER_GET_TOKEN */\n      );\n    }\n\n    this.swRegistration = swRegistration;\n  };\n  /**\r\n   * @param nextOrObserver An observer object or a function triggered on\r\n   * message.\r\n   * @return The unsubscribe function for the observer.\r\n   */\n  // TODO: Simplify this to only accept a function and not an Observer.\n\n\n  WindowController.prototype.onMessage = function (nextOrObserver) {\n    var _this = this;\n\n    this.onMessageCallback = typeof nextOrObserver === 'function' ? nextOrObserver : nextOrObserver.next;\n    return function () {\n      _this.onMessageCallback = null;\n    };\n  };\n\n  WindowController.prototype.setBackgroundMessageHandler = function () {\n    throw ERROR_FACTORY.create(\"only-available-in-sw\"\n    /* AVAILABLE_IN_SW */\n    );\n  }; // Unimplemented\n\n\n  WindowController.prototype.onTokenRefresh = function () {\n    return function () {};\n  };\n  /**\r\n   * Creates or updates the default service worker registration.\r\n   * @return The service worker registration to be used for the push service.\r\n   */\n\n\n  WindowController.prototype.getServiceWorkerRegistration = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, e_1;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            if (!!this.swRegistration) return [3\n            /*break*/\n            , 4];\n            _b.label = 1;\n\n          case 1:\n            _b.trys.push([1, 3,, 4]);\n\n            _a = this;\n            return [4\n            /*yield*/\n            , navigator.serviceWorker.register(DEFAULT_SW_PATH, {\n              scope: DEFAULT_SW_SCOPE\n            })];\n\n          case 2:\n            _a.swRegistration = _b.sent(); // The timing when browser updates sw when sw has an update is unreliable by my experiment. \n            // It leads to version conflict when the SDK upgrades to a newer version in the main page, but \n            // sw is stuck with the old version. For example, https://github.com/firebase/firebase-js-sdk/issues/2590\n            // The following line reliably updates sw if there was an update.\n\n            this.swRegistration.update().catch(function () {});\n            return [3\n            /*break*/\n            , 4];\n\n          case 3:\n            e_1 = _b.sent();\n            throw ERROR_FACTORY.create(\"failed-service-worker-registration\"\n            /* FAILED_DEFAULT_REGISTRATION */\n            , {\n              browserErrorMessage: e_1.message\n            });\n\n          case 4:\n            return [2\n            /*return*/\n            , this.swRegistration];\n        }\n      });\n    });\n  };\n\n  WindowController.prototype.messageEventListener = function (event) {\n    var _a;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var _b, type, payload, data;\n\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            if (!((_a = event.data) === null || _a === void 0 ? void 0 : _a.firebaseMessaging)) {\n              // Not a message from FCM\n              return [2\n              /*return*/\n              ];\n            }\n\n            _b = event.data.firebaseMessaging, type = _b.type, payload = _b.payload;\n\n            if (this.onMessageCallback && type === MessageType.PUSH_RECEIVED) {\n              this.onMessageCallback(payload);\n            }\n\n            data = payload.data;\n            if (!(isConsoleMessage(data) && data[CONSOLE_CAMPAIGN_ANALYTICS_ENABLED] === '1')) return [3\n            /*break*/\n            , 2]; // Analytics is enabled on this message, so we should log it.\n\n            return [4\n            /*yield*/\n            , this.logEvent(type, data)];\n\n          case 1:\n            // Analytics is enabled on this message, so we should log it.\n            _c.sent();\n\n            _c.label = 2;\n\n          case 2:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  WindowController.prototype.logEvent = function (messageType, data) {\n    return __awaiter(this, void 0, void 0, function () {\n      var eventType, analytics;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            eventType = getEventType(messageType);\n            return [4\n            /*yield*/\n            , this.firebaseDependencies.analyticsProvider.get()];\n\n          case 1:\n            analytics = _a.sent();\n            analytics.logEvent(eventType, {\n              /* eslint-disable camelcase */\n              message_id: data[CONSOLE_CAMPAIGN_ID],\n              message_name: data[CONSOLE_CAMPAIGN_NAME],\n              message_time: data[CONSOLE_CAMPAIGN_TIME],\n              message_device_time: Math.floor(Date.now() / 1000)\n              /* eslint-enable camelcase */\n\n            });\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  return WindowController;\n}();\n\nfunction getEventType(messageType) {\n  switch (messageType) {\n    case MessageType.NOTIFICATION_CLICKED:\n      return 'notification_open';\n\n    case MessageType.PUSH_RECEIVED:\n      return 'notification_foreground';\n\n    default:\n      throw new Error();\n  }\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/** Returns a promise that resolves after given time passes. */\n\n\nfunction sleep(ms) {\n  return new Promise(function (resolve) {\n    setTimeout(resolve, ms);\n  });\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar SwController =\n/** @class */\nfunction () {\n  function SwController(firebaseDependencies) {\n    var _this = this;\n\n    this.firebaseDependencies = firebaseDependencies;\n    this.vapidKey = null;\n    this.bgMessageHandler = null;\n    self.addEventListener('push', function (e) {\n      e.waitUntil(_this.onPush(e));\n    });\n    self.addEventListener('pushsubscriptionchange', function (e) {\n      e.waitUntil(_this.onSubChange(e));\n    });\n    self.addEventListener('notificationclick', function (e) {\n      e.waitUntil(_this.onNotificationClick(e));\n    });\n  }\n\n  Object.defineProperty(SwController.prototype, \"app\", {\n    get: function get() {\n      return this.firebaseDependencies.app;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Calling setBackgroundMessageHandler will opt in to some specific\r\n   * behaviours.\r\n   * 1.) If a notification doesn't need to be shown due to a window already\r\n   * being visible, then push messages will be sent to the page.\r\n   * 2.) If a notification needs to be shown, and the message contains no\r\n   * notification data this method will be called\r\n   * and the promise it returns will be passed to event.waitUntil.\r\n   * If you do not set this callback then all push messages will let and the\r\n   * developer can handle them in a their own 'push' event callback\r\n   *\r\n   * @param callback The callback to be called when a push message is received\r\n   * and a notification must be shown. The callback will be given the data from\r\n   * the push message.\r\n   */\n\n  SwController.prototype.setBackgroundMessageHandler = function (callback) {\n    if (!callback || typeof callback !== 'function') {\n      throw ERROR_FACTORY.create(\"invalid-bg-handler\"\n      /* INVALID_BG_HANDLER */\n      );\n    }\n\n    this.bgMessageHandler = callback;\n  }; // TODO: Remove getToken from SW Controller.\n  // Calling this from an old SW can cause all kinds of trouble.\n\n\n  SwController.prototype.getToken = function () {\n    var _a, _b, _c;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var tokenDetails;\n      return __generator(this, function (_d) {\n        switch (_d.label) {\n          case 0:\n            if (!!this.vapidKey) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , dbGet(this.firebaseDependencies)];\n\n          case 1:\n            tokenDetails = _d.sent();\n            this.vapidKey = (_c = (_b = (_a = tokenDetails) === null || _a === void 0 ? void 0 : _a.subscriptionOptions) === null || _b === void 0 ? void 0 : _b.vapidKey, _c !== null && _c !== void 0 ? _c : DEFAULT_VAPID_KEY);\n            _d.label = 2;\n\n          case 2:\n            return [2\n            /*return*/\n            , getToken(this.firebaseDependencies, self.registration, this.vapidKey)];\n        }\n      });\n    });\n  }; // TODO: Remove deleteToken from SW Controller.\n  // Calling this from an old SW can cause all kinds of trouble.\n\n\n  SwController.prototype.deleteToken = function () {\n    return deleteToken(this.firebaseDependencies, self.registration);\n  };\n\n  SwController.prototype.requestPermission = function () {\n    throw ERROR_FACTORY.create(\"only-available-in-window\"\n    /* AVAILABLE_IN_WINDOW */\n    );\n  }; // TODO: Deprecate this and make VAPID key a parameter in getToken.\n  // TODO: Remove this together with getToken from SW Controller.\n\n\n  SwController.prototype.usePublicVapidKey = function (vapidKey) {\n    if (this.vapidKey !== null) {\n      throw ERROR_FACTORY.create(\"use-vapid-key-after-get-token\"\n      /* USE_VAPID_KEY_AFTER_GET_TOKEN */\n      );\n    }\n\n    if (typeof vapidKey !== 'string' || vapidKey.length === 0) {\n      throw ERROR_FACTORY.create(\"invalid-vapid-key\"\n      /* INVALID_VAPID_KEY */\n      );\n    }\n\n    this.vapidKey = vapidKey;\n  };\n\n  SwController.prototype.useServiceWorker = function () {\n    throw ERROR_FACTORY.create(\"only-available-in-window\"\n    /* AVAILABLE_IN_WINDOW */\n    );\n  };\n\n  SwController.prototype.onMessage = function () {\n    throw ERROR_FACTORY.create(\"only-available-in-window\"\n    /* AVAILABLE_IN_WINDOW */\n    );\n  };\n\n  SwController.prototype.onTokenRefresh = function () {\n    throw ERROR_FACTORY.create(\"only-available-in-window\"\n    /* AVAILABLE_IN_WINDOW */\n    );\n  };\n  /**\r\n   * A handler for push events that shows notifications based on the content of\r\n   * the payload.\r\n   *\r\n   * The payload must be a JSON-encoded Object with a `notification` key. The\r\n   * value of the `notification` property will be used as the NotificationOptions\r\n   * object passed to showNotification. Additionally, the `title` property of the\r\n   * notification object will be used as the title.\r\n   *\r\n   * If there is no notification data in the payload then no notification will be\r\n   * shown.\r\n   */\n\n\n  SwController.prototype.onPush = function (event) {\n    return __awaiter(this, void 0, void 0, function () {\n      var payload, clientList, notificationDetails;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            payload = getMessagePayload(event);\n\n            if (!payload) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            return [4\n            /*yield*/\n            , getClientList()];\n\n          case 1:\n            clientList = _a.sent();\n\n            if (hasVisibleClients(clientList)) {\n              // App in foreground. Send to page.\n              return [2\n              /*return*/\n              , sendMessageToWindowClients(clientList, payload)];\n            }\n\n            notificationDetails = getNotificationData(payload);\n            if (!notificationDetails) return [3\n            /*break*/\n            , 3];\n            return [4\n            /*yield*/\n            , showNotification(notificationDetails)];\n\n          case 2:\n            _a.sent();\n\n            return [3\n            /*break*/\n            , 5];\n\n          case 3:\n            if (!this.bgMessageHandler) return [3\n            /*break*/\n            , 5];\n            return [4\n            /*yield*/\n            , this.bgMessageHandler(payload)];\n\n          case 4:\n            _a.sent();\n\n            _a.label = 5;\n\n          case 5:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  SwController.prototype.onSubChange = function (event) {\n    var _a, _b, _c;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var newSubscription, tokenDetails;\n      return __generator(this, function (_d) {\n        switch (_d.label) {\n          case 0:\n            newSubscription = event.newSubscription;\n            if (!!newSubscription) return [3\n            /*break*/\n            , 2]; // Subscription revoked, delete token\n\n            return [4\n            /*yield*/\n            , deleteToken(this.firebaseDependencies, self.registration)];\n\n          case 1:\n            // Subscription revoked, delete token\n            _d.sent();\n\n            return [2\n            /*return*/\n            ];\n\n          case 2:\n            return [4\n            /*yield*/\n            , dbGet(this.firebaseDependencies)];\n\n          case 3:\n            tokenDetails = _d.sent();\n            return [4\n            /*yield*/\n            , deleteToken(this.firebaseDependencies, self.registration)];\n\n          case 4:\n            _d.sent();\n\n            return [4\n            /*yield*/\n            , getToken(this.firebaseDependencies, self.registration, (_c = (_b = (_a = tokenDetails) === null || _a === void 0 ? void 0 : _a.subscriptionOptions) === null || _b === void 0 ? void 0 : _b.vapidKey, _c !== null && _c !== void 0 ? _c : DEFAULT_VAPID_KEY))];\n\n          case 5:\n            _d.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  SwController.prototype.onNotificationClick = function (event) {\n    var _a, _b;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var payload, link, client, message;\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            payload = (_b = (_a = event.notification) === null || _a === void 0 ? void 0 : _a.data) === null || _b === void 0 ? void 0 : _b[FCM_MSG];\n\n            if (!payload) {\n              // Not an FCM notification, do nothing.\n              return [2\n              /*return*/\n              ];\n            } else if (event.action) {\n              // User clicked on an action button.\n              // This will allow devs to act on action button clicks by using a custom\n              // onNotificationClick listener that they define.\n              return [2\n              /*return*/\n              ];\n            } // Prevent other listeners from receiving the event\n\n\n            event.stopImmediatePropagation();\n            event.notification.close();\n            link = getLink(payload);\n\n            if (!link) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            return [4\n            /*yield*/\n            , getWindowClient(link)];\n\n          case 1:\n            client = _c.sent();\n            if (!!client) return [3\n            /*break*/\n            , 4];\n            return [4\n            /*yield*/\n            , self.clients.openWindow(link)];\n\n          case 2:\n            // Unable to find window client so need to open one.\n            // This also focuses the opened client.\n            client = _c.sent(); // Wait three seconds for the client to initialize and set up the message\n            // handler so that it can receive the message.\n\n            return [4\n            /*yield*/\n            , sleep(3000)];\n\n          case 3:\n            // Wait three seconds for the client to initialize and set up the message\n            // handler so that it can receive the message.\n            _c.sent();\n\n            return [3\n            /*break*/\n            , 6];\n\n          case 4:\n            return [4\n            /*yield*/\n            , client.focus()];\n\n          case 5:\n            client = _c.sent();\n            _c.label = 6;\n\n          case 6:\n            if (!client) {\n              // Window Client will not be returned if it's for a third party origin.\n              return [2\n              /*return*/\n              ];\n            }\n\n            message = createNewMessage(MessageType.NOTIFICATION_CLICKED, payload);\n            return [2\n            /*return*/\n            , client.postMessage(message)];\n        }\n      });\n    });\n  };\n\n  return SwController;\n}();\n\nfunction getMessagePayload(_a) {\n  var data = _a.data;\n\n  if (!data) {\n    return null;\n  }\n\n  try {\n    return data.json();\n  } catch (err) {\n    // Not JSON so not an FCM message.\n    return null;\n  }\n}\n\nfunction getNotificationData(payload) {\n  var _a;\n\n  if (!payload || typeof payload.notification !== 'object') {\n    return;\n  }\n\n  var notificationInformation = __assign({}, payload.notification); // Put the message payload under FCM_MSG name so we can identify the\n  // notification as being an FCM notification vs a notification from\n  // somewhere else (i.e. normal web push or developer generated\n  // notification).\n\n\n  notificationInformation.data = __assign(__assign({}, payload.notification.data), (_a = {}, _a[FCM_MSG] = payload, _a));\n  return notificationInformation;\n}\n/**\r\n * @param url The URL to look for when focusing a client.\r\n * @return Returns an existing window client or a newly opened WindowClient.\r\n */\n\n\nfunction getWindowClient(url) {\n  return __awaiter(this, void 0, void 0, function () {\n    var parsedURL, clientList, clientList_1, clientList_1_1, client, parsedClientUrl;\n\n    var e_1, _a;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          parsedURL = new URL(url, self.location.href).href;\n          return [4\n          /*yield*/\n          , getClientList()];\n\n        case 1:\n          clientList = _b.sent();\n\n          try {\n            for (clientList_1 = __values(clientList), clientList_1_1 = clientList_1.next(); !clientList_1_1.done; clientList_1_1 = clientList_1.next()) {\n              client = clientList_1_1.value;\n              parsedClientUrl = new URL(client.url, self.location.href).href;\n\n              if (parsedClientUrl === parsedURL) {\n                return [2\n                /*return*/\n                , client];\n              }\n            }\n          } catch (e_1_1) {\n            e_1 = {\n              error: e_1_1\n            };\n          } finally {\n            try {\n              if (clientList_1_1 && !clientList_1_1.done && (_a = clientList_1.return)) _a.call(clientList_1);\n            } finally {\n              if (e_1) throw e_1.error;\n            }\n          }\n\n          return [2\n          /*return*/\n          , null];\n      }\n    });\n  });\n}\n/**\r\n * @returns If there is currently a visible WindowClient, this method will\r\n * resolve to true, otherwise false.\r\n */\n\n\nfunction hasVisibleClients(clientList) {\n  return clientList.some(function (client) {\n    return client.visibilityState === 'visible' && // Ignore chrome-extension clients as that matches the background pages\n    // of extensions, which are always considered visible for some reason.\n    !client.url.startsWith('chrome-extension://');\n  });\n}\n/**\r\n * @param payload The data from the push event that should be sent to all\r\n * available pages.\r\n * @returns Returns a promise that resolves once the message has been sent to\r\n * all WindowClients.\r\n */\n\n\nfunction sendMessageToWindowClients(clientList, payload) {\n  var e_2, _a;\n\n  var message = createNewMessage(MessageType.PUSH_RECEIVED, payload);\n\n  try {\n    for (var clientList_2 = __values(clientList), clientList_2_1 = clientList_2.next(); !clientList_2_1.done; clientList_2_1 = clientList_2.next()) {\n      var client = clientList_2_1.value;\n      client.postMessage(message);\n    }\n  } catch (e_2_1) {\n    e_2 = {\n      error: e_2_1\n    };\n  } finally {\n    try {\n      if (clientList_2_1 && !clientList_2_1.done && (_a = clientList_2.return)) _a.call(clientList_2);\n    } finally {\n      if (e_2) throw e_2.error;\n    }\n  }\n}\n\nfunction getClientList() {\n  return self.clients.matchAll({\n    type: 'window',\n    includeUncontrolled: true // TS doesn't know that \"type: 'window'\" means it'll return WindowClient[]\n\n  });\n}\n\nfunction createNewMessage(type, payload) {\n  return {\n    firebaseMessaging: {\n      type: type,\n      payload: payload\n    }\n  };\n}\n\nfunction showNotification(details) {\n  var _a;\n\n  var title = (_a = details.title, _a !== null && _a !== void 0 ? _a : '');\n  var actions = details.actions;\n  var maxActions = Notification.maxActions;\n\n  if (actions && maxActions && actions.length > maxActions) {\n    console.warn(\"This browser only supports \" + maxActions + \" actions. The remaining actions will not be displayed.\");\n  }\n\n  return self.registration.showNotification(title, details);\n}\n\nfunction getLink(payload) {\n  var _a, _b, _c; // eslint-disable-next-line camelcase\n\n\n  var link = (_b = (_a = payload.fcmOptions) === null || _a === void 0 ? void 0 : _a.link, _b !== null && _b !== void 0 ? _b : (_c = payload.notification) === null || _c === void 0 ? void 0 : _c.click_action);\n\n  if (link) {\n    return link;\n  }\n\n  if (isConsoleMessage(payload.data)) {\n    // Notification created in the Firebase Console. Redirect to origin.\n    return self.location.origin;\n  } else {\n    return null;\n  }\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar MESSAGING_NAME = 'messaging';\n\nfunction factoryMethod(container) {\n  // Dependencies.\n  var app = container.getProvider('app').getImmediate();\n  var appConfig = extractAppConfig(app);\n  var installations = container.getProvider('installations').getImmediate();\n  var analyticsProvider = container.getProvider('analytics-internal');\n  var firebaseDependencies = {\n    app: app,\n    appConfig: appConfig,\n    installations: installations,\n    analyticsProvider: analyticsProvider\n  };\n\n  if (!isSupported()) {\n    throw ERROR_FACTORY.create(\"unsupported-browser\"\n    /* UNSUPPORTED_BROWSER */\n    );\n  }\n\n  if (self && 'ServiceWorkerGlobalScope' in self) {\n    // Running in ServiceWorker context\n    return new SwController(firebaseDependencies);\n  } else {\n    // Assume we are in the window context.\n    return new WindowController(firebaseDependencies);\n  }\n}\n\nvar NAMESPACE_EXPORTS = {\n  isSupported: isSupported\n};\nfirebase.INTERNAL.registerComponent(new Component(MESSAGING_NAME, factoryMethod, \"PUBLIC\"\n/* PUBLIC */\n).setServiceProps(NAMESPACE_EXPORTS));\n\nfunction isSupported() {\n  if (self && 'ServiceWorkerGlobalScope' in self) {\n    // Running in ServiceWorker context\n    return isSWControllerSupported();\n  } else {\n    // Assume we are in the window context.\n    return isWindowControllerSupported();\n  }\n}\n/**\r\n * Checks to see if the required APIs exist.\r\n */\n\n\nfunction isWindowControllerSupported() {\n  return 'indexedDB' in window && indexedDB !== null && navigator.cookieEnabled && 'serviceWorker' in navigator && 'PushManager' in window && 'Notification' in window && 'fetch' in window && ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') && PushSubscription.prototype.hasOwnProperty('getKey');\n}\n/**\r\n * Checks to see if the required APIs exist within SW Context.\r\n */\n\n\nfunction isSWControllerSupported() {\n  return 'indexedDB' in self && indexedDB !== null && 'PushManager' in self && 'Notification' in self && ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') && PushSubscription.prototype.hasOwnProperty('getKey');\n}"],"sourceRoot":""}